name: Auto Increment Version

on:
  push:
    paths:
      - 'HebrewTools.dotm'

jobs:
  update-version:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Calculate Next Version
        id: calc
        run: |
          # 1. Read the current version from version.txt, default to 4.5 if it doesn't exist
          if [ -f version.txt ]; then
            OLD_VER=$(cat version.txt)
          else
            OLD_VER="4.5"
          fi

          # 2. Use python to add 0.1 (bash handles decimals poorly)
          NEW_VER=$(python3 -c "print(round($OLD_VER + 0.1, 1))")
          
          echo "Current: $OLD_VER"
          echo "Next: $NEW_VER"
          
          # 3. Save the new version
          echo "$NEW_VER" > version.txt
          echo "NEW_VERSION=$NEW_VER" >> $GITHUB_ENV

      - name: Commit and Push
        run: |
          git config --global user.name "Tosh Developers Bot"
          git config --global user.email "actions@github.com"
          git add version.txt
          git commit -m "Auto-increment version to ${{ env.NEW_VERSION }}"
          git push
